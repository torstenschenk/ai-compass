1. Content & Wording
The objective is to move from raw data to "Decision Intelligence." The wording must be sharp, diagnostic, and prioritize the two most impactful findings.
Component Header:
Headline: Strategic Gap Analysis
Sub-headline: Identifying the "Delta" between your current position and the next level.
Card 1: The Talent Gap (People & Culture)
Context: Used when a high Delta exists between Leadership Strategy and Workforce Readiness.
Status Quo Text: "While your leadership has a clear vision, there is a disconnect with the operational workforce. 65% of your responses indicate a 'Cautious' mindset toward AI."
Strategic Risk: "Without addressing psychological safety and upskilling, your technical tools will lack the adoption needed for ROI."
Badge: HIGH
Card 2: The Compliance Vulnerability (Governance & Ethics)
Context: Used when high-weight checklist items (like AI Policy or Code of Conduct) are missing.
Status Quo Text: "Your technical velocity is outpacing your oversight. The lack of a defined 'AI Code of Conduct' creates significant long-term legal and reputational risks."
Strategic Risk: "Specifically regarding upcoming EU AI Act requirements, the absence of governance poses a critical liability to scaling operations."
Badge: CRITICAL

2. Design & UI SpecificationsThe design focuses on "Risk Awareness."
It should feel different from the Maturity Profile by using warmer, alert-driven colors.
Layout:Container: Two stacked horizontal cards (Flexbox/Grid).
Spacing: $24\text{px}$ gap between cards; 
$32\text{px}$ padding inside cards.
Visual Elements using Icons

3. Technical Requirements (MVP Implementation)
The "Logic Engine" must execute the two-stage logic defined in the objective.
Stage 1: Statistical Analysis ($Z$-Scores)
Formula: $Z = (x - \mu) / \sigma$ (where $x$ is the user's score, $\mu$ is peer mean, $\sigma$ is peer std dev).
Detection: Flag any dimension where $Z < -1.2$.
Prioritization: If multiple dimensions are flagged, select the one with the largest Delta to the "Strategy" dimension.
Stage 2: Weighted Checklist Logic
Data Source: checklist_items table with columns [item_id, status (boolean), question_weight (integer)].
Execution: Filter for status = False. Sort by question_weight descending.
Output: Select the top item as the second gap (typically Compliance or Data Governance).
LLM Prompt for Dynamic Synthesis:Input Variables: {{dimension_scores}}, {{top_missing_checklist_items}}, {{industry_benchmarks}}.Constraint: "Generate exactly 2 gaps. 
Use the 'Status Quo vs. Strategic Risk' format. Limit each description to 30 words to prevent UI overflow."


# Strategic Gap Analysis (MVP) ‚Äî Spec

# 8.4 Strategic Gap Analysis - ML v5 Implementation

## Overview
The ML v5 Strategic Gap Analysis identifies critical weaknesses and structural imbalances in a company's AI maturity profile using statistical analysis and weighted impact scoring.

---

## 1. Purpose
Generate **exactly 2** diagnostic findings:
- **Finding 1**: Highest-impact weakness or structural imbalance
- **Finding 2**: Second highest-impact weakness or growth opportunity

---

## 2. Detection Logic

### 2.1 Anomaly Detection (Structural Imbalances)
**Method**: Z-score analysis of dimension pairs from RISK_PAIRS

**Formula**: `Z = (dim1 - dim2) / œÉ`

**Detection Threshold**: `|Z| > 2.0`

**RISK_PAIRS** (predefined):
```python
[
    ("Strategy & Business Vision", "People & Culture"),
    ("Use Cases & Business Value", "Data Readiness & Literacy"),
    ("Processes & Scaling", "Governance & Compliance"),
    ("Tech Infrastructure", "Governance & Compliance")
]
```

**Output**:
```json
{
  "type": "Anomaly",
  "title": "Structural Imbalance: Processes & Scaling vs Governance & Compliance",
  "severity_score": 2.7,
  "context": "Gap of 1.2 points (Z=2.7). Disconnect between Processes & Scaling (3.2) and Governance & Compliance (2.0).",
  "dimension_name": "Processes & Scaling",
  "tactical_theme": "Structural Imbalance"
}
```

### 2.2 Weighted Impact Analysis (Critical Gaps)
**Method**: Question-level weighted impact scoring

**Formula**: `Impact = Strategic_Weight √ó (Peer_Avg - Company_Score)`

**Detection**: Identify tactical themes with highest impact scores

**Output**:
```json
{
  "type": "Weakness",
  "title": "Critical Gap: Staff Proficiency",
  "severity_score": 11.2,
  "context": "High Strategic Impact (3.5). Current Maturity: 1.8. Theme: Staff Proficiency.",
  "dimension_name": "Data Readiness & Literacy",
  "tactical_theme": "Staff Proficiency"
}
```

---

## 3. Output Format

### 3.1 API Response Structure
```json
{
  "strategic_gap_analysis": {
    "executive_briefing": "### üéñÔ∏è AI-Compass Strategic Briefing\n\n...",
    "detailed_findings": [
      {
        "type": "Weakness | Anomaly",
        "title": "Critical Gap: [Theme Name]",
        "severity_score": 11.2,
        "context": "Detailed explanation...",
        "dimension_name": "Data Readiness & Literacy",
        "tactical_theme": "Staff Proficiency"
      }
    ]
  }
}
```

### 3.2 Executive Briefing
**Structure**:
1. Opening statement identifying primary risks
2. First finding explanation with strategic debt concept
3. Second finding explanation with bottleneck impact
4. Strategic verdict with 3-month transformation timeline

**Template**:
```
Our analysis identifies two primary structural risks requiring immediate executive attention.

Firstly, [Finding 1 Title]. [Context]. This suggests your organizational trajectory 
may be creating 'Strategic Debt'‚Äîwhere technical capabilities outpace leadership 
alignment or vice versa.

Secondly, [Finding 2 Title]. [Context]. This maturity level acts as a significant 
bottleneck. Addressing this area will unlock higher ROI for existing and future AI use cases.

Strategic Verdict: Your profile shows high potential but is currently decoupled. 
Prioritizing these two areas over the next 3 months will transform your AI initiatives 
from experimental to scalable.
```

---

## 4. Severity Scoring

### 4.1 Current Implementation
- **Anomaly Score**: Absolute Z-score value (typically 2.0-4.0)
- **Weakness Score**: Weighted impact score (typically 8.0-15.0)

### 4.2 Badge Mapping (for Frontend)
```python
def get_badge_level(severity_score, finding_type):
    if finding_type == "Weakness":
        if severity_score >= 12: return "CRITICAL"
        elif severity_score >= 8: return "HIGH"
        else: return "MEDIUM"
    else:  # Anomaly
        if severity_score >= 3.0: return "CRITICAL"
        elif severity_score >= 2.5: return "HIGH"
        else: return "MEDIUM"
```

---

## 5. Key Differences from Original Spec

### 5.1 What's Different
| Aspect | Original Spec | ML v5 Implementation |
|--------|---------------|---------------------|
| Gap B Source | Checklist/controls | Weighted impact scoring |
| Output Fields | `status_quo`, `strategic_risk` | `context`, `severity_score` |
| Badge System | Built-in | Requires mapping function |
| Gap Types | Statistical only | Anomaly + Weakness |

### 5.2 What's Enhanced
- ‚úÖ **Tactical theme identification** for targeted recommendations
- ‚úÖ **Dimension attribution** for each finding
- ‚úÖ **Executive briefing synthesis** with narrative
- ‚úÖ **Dual detection methods** (anomaly + weighted impact)

---

## 6. Frontend Integration

### 6.1 Display Format
Each finding should render as a card with:
- **Title**: Finding title (e.g., "Critical Gap: Staff Proficiency")
- **Badge**: CRITICAL/HIGH/MEDIUM (use mapping function)
- **Context**: Full context text
- **Dimension**: Associated dimension name
- **Theme**: Tactical theme for linking to roadmap

### 6.2 Styling Recommendations
- **CRITICAL**: Red accent (#DC2626)
- **HIGH**: Orange accent (#EA580C)
- **MEDIUM**: Amber accent (#D97706)

---

## 7. Technical Implementation

### 7.1 Model Class
`StrategicGapAnalyzer` in `models.py`

**Methods**:
- `fit(dim_data)`: Learn population statistics
- `analyze(company_dim_series, company_question_df)`: Generate findings
- `synthesize_narrative(findings, company_dim_series)`: Create briefing

### 7.2 Data Requirements
**Inputs**:
- `dimension_scores`: Dict of 7 dimension scores (1-5 scale)
- `question_data`: DataFrame with question-level scores and metadata

**Outputs**:
- List of findings (typically 2)
- Executive briefing text

---

## 8. Example Output

```json
{
  "strategic_gap_analysis": {
    "executive_briefing": "### üéñÔ∏è AI-Compass Strategic Briefing\n\nOur analysis of your current AI maturity profile identifies two primary structural risks that require immediate executive attention.\n\nFirstly, we have identified a **Critical Gap: Staff Proficiency**. High Strategic Impact (3.5). Current Maturity: 1.8. Theme: Staff Proficiency. This suggests that your current organizational trajectory may be creating 'Strategic Debt'‚Äîwhere technical capabilities outpace leadership alignment or vice versa.\n\nSecondly, the **Critical Gap: Leadership Alignment** indicates a critical gap in your foundational readiness. Currently, this maturity level (10.8 impact score) acts as a significant bottleneck. Addressing this specific area will unlock higher ROI for your existing and future AI use cases.\n\n**Strategic Verdict**: Your profile shows high potential but is currently decoupled. Prioritizing these two areas over the next 3 months will transform your AI initiatives from experimental to scalable.",
    "detailed_findings": [
      {
        "type": "Weakness",
        "title": "Critical Gap: Staff Proficiency",
        "severity_score": 11.2,
        "context": "High Strategic Impact (3.5). Current Maturity: 1.8. Theme: Staff Proficiency.",
        "dimension_name": "Data Readiness & Literacy",
        "tactical_theme": "Staff Proficiency"
      },
      {
        "type": "Weakness",
        "title": "Critical Gap: Leadership Alignment",
        "severity_score": 10.8,
        "context": "High Strategic Impact (4.5). Current Maturity: 2.6. Theme: Leadership Alignment.",
        "dimension_name": "Strategy & Business Vision",
        "tactical_theme": "Leadership Alignment"
      }
    ]
  }
}
```
